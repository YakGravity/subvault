<!DOCTYPE html>
<html lang="{{.Lang}}">
<head>
    <script src="/static/js/theme-init.js"></script>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{.CSRFToken}}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#c2410c">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <title>{{.Title}} - SubTrackr</title>
    <script src="/static/js/htmx.min.js"></script>
    <script src="/static/js/csrf.js"></script>
    <link rel="stylesheet" href="/static/css/design-system.css">
    <link rel="stylesheet" href="/static/css/themes.css">
    <script src="/static/js/themes.js"></script>
</head>
<body>
    {{template "sidebar" .}}

    <!-- Main Content -->
    <div class="main">
        <div class="page-header">
            <div>
                <h1>{{.T.Tr "nav_settings"}}</h1>
                <div class="page-header-sub">{{.T.Tr "settings_general_subtitle"}}</div>
            </div>
        </div>

        <div class="tab-bar">
            <a href="/settings" class="tab-item active">{{.T.Tr "settings_tab_general"}}</a>
            <a href="/settings/notifications" class="tab-item">{{.T.Tr "settings_tab_notifications"}}</a>
            <a href="/settings/data" class="tab-item">{{.T.Tr "settings_tab_data"}}</a>
            <a href="/settings/appearance" class="tab-item">{{.T.Tr "settings_tab_appearance"}}</a>
            <a href="/settings/security" class="tab-item">{{.T.Tr "settings_tab_security"}}</a>
        </div>

<div style="display:flex;flex-direction:column;gap:32px;">

    <!-- Language -->
    <div class="card">
        <div style="padding:20px;">
            <h3 style="font-size:15px;font-weight:600;color:var(--text);margin-bottom:4px;">{{.T.Tr "settings_language"}}</h3>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px;">{{.T.Tr "settings_language_desc"}}</p>
            <div style="display:flex;gap:16px;">
                <label style="display:flex;align-items:center;">
                    <input type="radio" name="language" value="en"
                           {{if eq .Language "en"}}checked{{end}}
                           hx-post="/api/settings/language" hx-trigger="change" hx-vals='{"language": "en"}'
                           style="margin-right:8px;accent-color:var(--accent);">
                    <span style="font-size:13px;font-weight:500;color:var(--text);">{{.T.Tr "lang_en"}}</span>
                </label>
                <label style="display:flex;align-items:center;">
                    <input type="radio" name="language" value="de"
                           {{if eq .Language "de"}}checked{{end}}
                           hx-post="/api/settings/language" hx-trigger="change" hx-vals='{"language": "de"}'
                           style="margin-right:8px;accent-color:var(--accent);">
                    <span style="font-size:13px;font-weight:500;color:var(--text);">{{.T.Tr "lang_de"}}</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Currency -->
    <div class="card">
        <div style="padding:20px;">
            <h3 style="font-size:15px;font-weight:600;color:var(--text);margin-bottom:4px;">{{.T.Tr "settings_currency"}}</h3>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px;">{{.T.Tr "settings_currency_desc"}}</p>

        <select name="currency" class="form-input" style="max-width:320px;"
                onchange="htmx.ajax('POST', '/api/settings/currency', {values: {currency: this.value}, target: '#currency-message', swap: 'innerHTML'})">
            <option value="USD" {{if or (eq .Currency "USD") (eq .Currency "")}}selected{{end}}>$ USD - {{.T.Tr "currency_usd"}}</option>
            <option value="EUR" {{if eq .Currency "EUR"}}selected{{end}}>EUR - {{.T.Tr "currency_eur"}}</option>
            <option value="GBP" {{if eq .Currency "GBP"}}selected{{end}}>GBP - {{.T.Tr "currency_gbp"}}</option>
            <option value="CHF" {{if eq .Currency "CHF"}}selected{{end}}>Fr. CHF - {{.T.Tr "currency_chf"}}</option>
            <option value="JPY" {{if eq .Currency "JPY"}}selected{{end}}>JPY - {{.T.Tr "currency_jpy"}}</option>
            <option value="AUD" {{if eq .Currency "AUD"}}selected{{end}}>A$ AUD - {{.T.Tr "currency_aud"}}</option>
            <option value="CAD" {{if eq .Currency "CAD"}}selected{{end}}>C$ CAD - {{.T.Tr "currency_cad"}}</option>
            <option value="SEK" {{if eq .Currency "SEK"}}selected{{end}}>kr SEK - {{.T.Tr "currency_sek"}}</option>
            <option value="NOK" {{if eq .Currency "NOK"}}selected{{end}}>kr NOK - {{.T.Tr "currency_nok"}}</option>
            <option value="DKK" {{if eq .Currency "DKK"}}selected{{end}}>kr DKK - {{.T.Tr "currency_dkk"}}</option>
            <option value="PLN" {{if eq .Currency "PLN"}}selected{{end}}>PLN - {{.T.Tr "currency_pln"}}</option>
            <option value="CZK" {{if eq .Currency "CZK"}}selected{{end}}>CZK - {{.T.Tr "currency_czk"}}</option>
            <option value="HUF" {{if eq .Currency "HUF"}}selected{{end}}>Ft HUF - {{.T.Tr "currency_huf"}}</option>
            <option value="RON" {{if eq .Currency "RON"}}selected{{end}}>lei RON - {{.T.Tr "currency_ron"}}</option>
            <option value="ISK" {{if eq .Currency "ISK"}}selected{{end}}>kr ISK - {{.T.Tr "currency_isk"}}</option>
            <option value="INR" {{if eq .Currency "INR"}}selected{{end}}>INR - {{.T.Tr "currency_inr"}}</option>
            <option value="CNY" {{if eq .Currency "CNY"}}selected{{end}}>CNY - {{.T.Tr "currency_cny"}}</option>
            <option value="KRW" {{if eq .Currency "KRW"}}selected{{end}}>KRW - {{.T.Tr "currency_krw"}}</option>
            <option value="SGD" {{if eq .Currency "SGD"}}selected{{end}}>S$ SGD - {{.T.Tr "currency_sgd"}}</option>
            <option value="HKD" {{if eq .Currency "HKD"}}selected{{end}}>HK$ HKD - {{.T.Tr "currency_hkd"}}</option>
            <option value="MYR" {{if eq .Currency "MYR"}}selected{{end}}>RM MYR - {{.T.Tr "currency_myr"}}</option>
            <option value="THB" {{if eq .Currency "THB"}}selected{{end}}>THB - {{.T.Tr "currency_thb"}}</option>
            <option value="IDR" {{if eq .Currency "IDR"}}selected{{end}}>Rp IDR - {{.T.Tr "currency_idr"}}</option>
            <option value="PHP" {{if eq .Currency "PHP"}}selected{{end}}>PHP - {{.T.Tr "currency_php"}}</option>
            <option value="BRL" {{if eq .Currency "BRL"}}selected{{end}}>R$ BRL - {{.T.Tr "currency_brl"}}</option>
            <option value="MXN" {{if eq .Currency "MXN"}}selected{{end}}>MX$ MXN - {{.T.Tr "currency_mxn"}}</option>
            <option value="COP" {{if eq .Currency "COP"}}selected{{end}}>$ COP - {{.T.Tr "currency_cop"}}</option>
            <option value="ZAR" {{if eq .Currency "ZAR"}}selected{{end}}>R ZAR - {{.T.Tr "currency_zar"}}</option>
            <option value="TRY" {{if eq .Currency "TRY"}}selected{{end}}>TRY - {{.T.Tr "currency_try"}}</option>
            <option value="RUB" {{if eq .Currency "RUB"}}selected{{end}}>RUB - {{.T.Tr "currency_rub"}}</option>
            <option value="ILS" {{if eq .Currency "ILS"}}selected{{end}}>ILS - {{.T.Tr "currency_ils"}}</option>
            <option value="NZD" {{if eq .Currency "NZD"}}selected{{end}}>NZ$ NZD - {{.T.Tr "currency_nzd"}}</option>
            <option value="BDT" {{if eq .Currency "BDT"}}selected{{end}}>BDT - {{.T.Tr "currency_bdt"}}</option>
        </select>
            <div id="currency-message" style="margin-top:8px;"></div>
        </div>
    </div>

    <!-- Date Format -->
    <div class="card">
        <div style="padding:20px;">
            <h3 style="font-size:15px;font-weight:600;color:var(--text);margin-bottom:4px;">{{.T.Tr "settings_dateformat_title"}}</h3>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px;">{{.T.Tr "settings_dateformat_desc"}}</p>
            <div style="display:flex;flex-direction:column;gap:10px;" id="dateformat-options">
                <label style="display:flex;align-items:center;gap:12px;cursor:pointer;">
                    <input type="radio" name="dateformat" value="DD.MM.YYYY" style="accent-color:var(--accent);">
                    <div>
                        <span style="font-size:13px;font-weight:500;color:var(--text);">DD.MM.YYYY</span>
                        <span style="font-size:12px;color:var(--text-secondary);margin-left:8px;" data-preview="DD.MM.YYYY"></span>
                    </div>
                </label>
                <label style="display:flex;align-items:center;gap:12px;cursor:pointer;">
                    <input type="radio" name="dateformat" value="MM/DD/YYYY" style="accent-color:var(--accent);">
                    <div>
                        <span style="font-size:13px;font-weight:500;color:var(--text);">MM/DD/YYYY</span>
                        <span style="font-size:12px;color:var(--text-secondary);margin-left:8px;" data-preview="MM/DD/YYYY"></span>
                    </div>
                </label>
                <label style="display:flex;align-items:center;gap:12px;cursor:pointer;">
                    <input type="radio" name="dateformat" value="YYYY-MM-DD" style="accent-color:var(--accent);">
                    <div>
                        <span style="font-size:13px;font-weight:500;color:var(--text);">YYYY-MM-DD</span>
                        <span style="font-size:12px;color:var(--text-secondary);margin-left:8px;" data-preview="YYYY-MM-DD"></span>
                    </div>
                </label>
            </div>
        </div>
    </div>

</div>

    </div><!-- /.main -->
<script>
    // Date format
    var savedFormat = '{{.DateFormat}}';
    var today = new Date();
    var dd = String(today.getDate()).padStart(2,'0');
    var mm = String(today.getMonth()+1).padStart(2,'0');
    var yyyy = today.getFullYear();
    var previews = {
        'DD.MM.YYYY': dd+'.'+mm+'.'+yyyy,
        'MM/DD/YYYY': mm+'/'+dd+'/'+yyyy,
        'YYYY-MM-DD': yyyy+'-'+mm+'-'+dd
    };
    document.querySelectorAll('[data-preview]').forEach(function(el) {
        el.textContent = previews[el.dataset.preview] || '';
    });
    document.querySelectorAll('input[name="dateformat"]').forEach(function(radio) {
        if (radio.value === savedFormat) radio.checked = true;
        radio.addEventListener('change', function() {
            fetch('/api/settings/date-format', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'format=' + encodeURIComponent(this.value)
            });
        });
    });
</script>
</body>
</html>
